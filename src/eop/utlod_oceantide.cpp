#include "doodson.hpp"
#include "eop.hpp"
#include <array>
#include <cmath>

namespace {
struct Table8Data {
  /* Doodson numbers from IERS 2010, Tables 8.3a and 8.3b */
  dso::DoodsonConstituent dn;
  /* cooresponding Coefficients of sin(argument) and cos(argument) */
  double xs, xc, ys, yc;
};
constexpr const std::array<Table8Data, 71> Table83 = {
    {{{1, -4, 2, 1, 0, 0},
      +4.00000e-01,
      -8.00000e-02,
      -4.00000e-01,
      -2.10000e+00},
     {{1, -3, 0, 2, -1, 0},
      +1.90000e-01,
      -6.00000e-02,
      -3.00000e-01,
      -1.10000e+00},
     {{1, -3, 0, 2, 0, 0},
      +1.03000e+00,
      -3.10000e-01,
      -1.70000e+00,
      -5.60000e+00},
     {{1, -3, 2, 0, -1, 0},
      +2.20000e-01,
      -7.00000e-02,
      -4.00000e-01,
      -1.20000e+00},
     {{1, -3, 2, 0, 0, 0},
      +1.19000e+00,
      -3.90000e-01,
      -2.10000e+00,
      -6.40000e+00},
     {{1, -2, 0, 1, -1, 0},
      +9.70000e-01,
      -4.70000e-01,
      -2.70000e+00,
      -5.40000e+00},
     {{1, -2, 0, 1, 0, 0},
      +5.12000e+00,
      -2.50000e+00,
      -1.40000e+01,
      -2.87000e+01},
     {{1, -2, 2, -1, -1, 0},
      +1.70000e-01,
      -9.00000e-02,
      -5.00000e-01,
      -1.00000e+00},
     {{1, -2, 2, -1, 0, 0},
      +9.10000e-01,
      -4.70000e-01,
      -2.70000e+00,
      -5.10000e+00},
     {{1, -1, 0, 0, -2, 0},
      -9.00000e-02,
      +7.00000e-02,
      +4.00000e-01,
      +5.00000e-01},
     {{1, -1, 0, 0, -1, 0},
      +3.03000e+00,
      -2.28000e+00,
      -1.33000e+01,
      -1.77000e+01},
     {{1, -1, 0, 0, 0, 0},
      +1.60200e+01,
      -1.20700e+01,
      -7.05000e+01,
      -9.36000e+01},
     {{1, -1, 0, 2, 0, 0},
      -1.00000e-01,
      +8.00000e-02,
      +5.00000e-01,
      +6.00000e-01},
     {{1, -1, 2, 0, 0, 0},
      -1.90000e-01,
      +1.50000e-01,
      +9.00000e-01,
      +1.10000e+00},
     {{1, 0, -2, 1, 0, 0},
      -8.00000e-02,
      +7.00000e-02,
      +5.00000e-01,
      +5.00000e-01},
     {{1, 0, 0, -1, -1, 0},
      -6.00000e-02,
      +5.00000e-02,
      +3.00000e-01,
      +4.00000e-01},
     {{1, 0, 0, -1, 0, 0},
      -3.10000e-01,
      +2.70000e-01,
      +1.70000e+00,
      +1.90000e+00},
     {{1, 0, 0, 1, 0, 0},
      -8.60000e-01,
      +7.50000e-01,
      +4.60000e+00,
      +5.20000e+00},
     {{1, 0, 0, 1, 1, 0},
      -1.70000e-01,
      +1.50000e-01,
      +9.00000e-01,
      +1.00000e+00},
     {{1, 0, 2, -1, 0, 0},
      -1.60000e-01,
      +1.40000e-01,
      +8.00000e-01,
      +1.00000e+00},
     {{1, 1, -3, 0, 0, 1},
      +3.10000e-01,
      -1.90000e-01,
      -1.20000e+00,
      -2.00000e+00},
     {{1, 1, -2, 0, -1, 0},
      -6.00000e-02,
      +3.00000e-02,
      +2.00000e-01,
      +4.00000e-01},
     {{1, 1, -2, 0, 0, 0},
      +5.51000e+00,
      -3.10000e+00,
      -1.94000e+01,
      -3.45000e+01},
     {{1, 1, -1, 0, 0, -1},
      -5.00000e-02,
      +2.00000e-02,
      +2.00000e-01,
      +3.00000e-01},
     {{1, 1, -1, 0, 0, 1},
      -1.30000e-01,
      +7.00000e-02,
      +4.00000e-01,
      +8.00000e-01},
     {{1, 1, 0, 0, -1, 0},
      +3.50000e-01,
      -1.70000e-01,
      -1.10000e+00,
      -2.20000e+00},
     {{1, 1, 0, 0, 0, 0},
      -1.76200e+01,
      +8.55000e+00,
      +5.39000e+01,
      +1.11000e+02},
     {{1, 1, 0, 0, 1, 0},
      -2.39000e+00,
      +1.16000e+00,
      +7.30000e+00,
      +1.51000e+01},
     {{1, 1, 0, 0, 2, 0},
      +5.00000e-02,
      -3.00000e-02,
      -2.00000e-01,
      -3.00000e-01},
     {{1, 1, 1, 0, 0, -1},
      -1.40000e-01,
      +6.00000e-02,
      +4.00000e-01,
      +9.00000e-01},
     {{1, 1, 2, 0, 0, 0},
      -2.70000e-01,
      +1.10000e-01,
      +7.00000e-01,
      +1.70000e+00},
     {{1, 2, -2, 1, 0, 0},
      -2.90000e-01,
      +4.00000e-02,
      +3.00000e-01,
      +1.90000e+00},
     {{1, 2, 0, -1, 0, 0},
      -1.61000e+00,
      +1.90000e-01,
      +1.20000e+00,
      +1.05000e+01},
     {{1, 2, 0, -1, 1, 0},
      -3.20000e-01,
      +4.00000e-02,
      +2.00000e-01,
      +2.10000e+00},
     {{1, 3, -2, 0, 0, 0},
      -4.10000e-01,
      -1.00000e-02,
      -0.00000e+00,
      +2.70000e+00},
     {{1, 3, 0, -2, 0, 0},
      -2.10000e-01,
      -1.00000e-02,
      -0.00000e+00,
      +1.40000e+00},
     {{1, 3, 0, 0, 0, 0},
      -1.44000e+00,
      -4.00000e-02,
      -3.00000e-01,
      +9.70000e+00},
     {{1, 3, 0, 0, 1, 0},
      -9.20000e-01,
      -2.00000e-02,
      -2.00000e-01,
      +6.20000e+00},
     {{1, 3, 0, 0, 2, 0},
      -1.90000e-01,
      +0.00000e+00,
      -0.00000e+00,
      +1.30000e+00},
     {{1, 4, 0, -1, 0, 0},
      -4.00000e-01,
      -2.00000e-02,
      -2.00000e-01,
      +2.80000e+00},
     {{1, 4, 0, -1, 1, 0},
      -2.50000e-01,
      -2.00000e-02,
      -1.00000e-01,
      +1.80000e+00},
     {{2, -3, 0, 3, 0, 0},
      -9.00000e-02,
      -1.00000e-02,
      -1.00000e-01,
      +1.00000e+00},
     {{2, -3, 2, 1, 0, 0},
      -2.20000e-01,
      -3.00000e-02,
      -4.00000e-01,
      +2.60000e+00},
     {{2, -2, 0, 2, 0, 0},
      -6.40000e-01,
      -1.80000e-01,
      -2.10000e+00,
      +7.40000e+00},
     {{2, -2, 2, 0, 0, 0},
      -7.40000e-01,
      -2.20000e-01,
      -2.60000e+00,
      +8.70000e+00},
     {{2, -2, 3, 0, 0, -1},
      -5.00000e-02,
      -2.00000e-02,
      -2.00000e-01,
      +6.00000e-01},
     {{2, -1, -1, 1, 0, 1},
      +3.00000e-02,
      +1.00000e-02,
      +2.00000e-01,
      -4.00000e-01},
     {{2, -1, 0, 1, -1, 0},
      +1.40000e-01,
      +6.00000e-02,
      +7.00000e-01,
      -1.70000e+00},
     {{2, -1, 0, 1, 0, 0},
      -3.79000e+00,
      -1.56000e+00,
      -1.86000e+01,
      +4.52000e+01},
     {{2, -1, 1, 1, 0, -1},
      -3.00000e-02,
      -1.00000e-02,
      -2.00000e-01,
      +4.00000e-01},
     {{2, -1, 2, -1, 0, 0},
      -7.00000e-01,
      -3.00000e-01,
      -3.60000e+00,
      +8.30000e+00},
     {{2, -1, 3, -1, 0, -1},
      -3.00000e-02,
      -1.00000e-02,
      -2.00000e-01,
      +4.00000e-01},
     {{2, 0, -2, 2, 0, 0},
      +5.00000e-02,
      +2.00000e-02,
      +3.00000e-01,
      -6.00000e-01},
     {{2, 0, -1, 0, 0, 1},
      +6.00000e-02,
      +3.00000e-02,
      +3.00000e-01,
      -7.00000e-01},
     {{2, 0, 0, 0, -1, 0},
      +6.00000e-01,
      +2.70000e-01,
      +3.20000e+00,
      -7.30000e+00},
     {{2, 0, 0, 0, 0, 0},
      -1.61900e+01,
      -7.25000e+00,
      -8.68000e+01,
      +1.96600e+02},
     {{2, 0, 1, 0, 0, -1},
      -5.00000e-02,
      -2.00000e-02,
      -3.00000e-01,
      +6.00000e-01},
     {{2, 1, -2, 1, 0, 0},
      +1.10000e-01,
      +3.00000e-02,
      +4.00000e-01,
      -1.40000e+00},
     {{2, 1, 0, -1, 0, 0},
      +4.20000e-01,
      +1.20000e-01,
      +1.40000e+00,
      -5.30000e+00},
     {{2, 1, 0, 1, 0, 0},
      -1.10000e-01,
      -3.00000e-02,
      -4.00000e-01,
      +1.30000e+00},
     {{2, 1, 0, 1, 1, 0},
      -5.00000e-02,
      -1.00000e-02,
      -2.00000e-01,
      +6.00000e-01},
     {{2, 2, -3, 0, 0, 1},
      -4.40000e-01,
      -2.00000e-02,
      -2.00000e-01,
      +5.50000e+00},
     {{2, 2, -2, 0, 0, 0},
      -7.55000e+00,
      -1.60000e-01,
      -2.00000e+00,
      +9.48000e+01},
     {{2, 2, -1, 0, 0, -1},
      +6.00000e-02,
      +0.00000e+00,
      +0.00000e+00,
      -8.00000e-01},
     {{2, 2, 0, 0, -1, 0},
      +3.00000e-02,
      +0.00000e+00,
      -0.00000e+00,
      -3.00000e-01},
     {{2, 2, 0, 0, 0, 0},
      -2.10000e+00,
      +4.00000e-02,
      +5.00000e-01,
      +2.65000e+01},
     {{2, 2, 0, 0, 1, 0},
      -6.30000e-01,
      +1.00000e-02,
      +2.00000e-01,
      +7.90000e+00},
     {{2, 2, 0, 0, 2, 0},
      -7.00000e-02,
      +0.00000e+00,
      +0.00000e+00,
      +9.00000e-01},
     {{2, 3, 0, -1, 0, 0},
      -1.50000e-01,
      +4.00000e-02,
      +5.00000e-01,
      +1.90000e+00},
     {{2, 3, 0, -1, 1, 0},
      -6.00000e-02,
      +2.00000e-02,
      +2.00000e-01,
      +8.00000e-01},
     {{2, 4, 0, 0, 0, 0},
      -5.00000e-02,
      +2.00000e-02,
      +2.00000e-01,
      +6.00000e-01}}}; /* Table */

} /* unnamed namespace */

int dso::utlod_oceantide(const double *const fargs, double gmst, double &dut1,
                         double &dlod) noexcept {
  /* get Doodson arguments from Delaunay arguments and GMST */
  double dargs[6];
  dso::delaunay2doodson(fargs, gmst, dargs);
  /* these will never change */
  const double *__restrict__ f = dargs;

  /* set corrections to zero */
  dut1 = dlod = 0e0;
  for (const auto &entry : Table83) {
    const double arg = entry.dn.argument(f);
    const double sa = std::sin(arg);
    const double ca = std::cos(arg);
    dut1 += sa * entry.xs + ca * entry.xc; /* microseconds */
    dlod += sa * entry.ys + ca * entry.yc; /* microseconds */
  }

  return 0;
}
