#! /usr/bin/python

import math
import datetime
import sys

## ---------------------------------------------------------------------------
## Dummy script to compute C(3,2) and S(3,2) for given epochs using the 
## EIGEN-GRGS.RL04.MEAN-FIELD.gfc model.
## This script is meant to assist testing of parsing ICGEM files.
## ---------------------------------------------------------------------------

def d2s(date_str):
    """ handle dates with minutes == 60, e.g. 20041226.0060 """
    date_str = date_str.strip()
    try:
        return datetime.datetime.strptime(date_str, '%Y%m%d.%H%M')
    except:
        pass
    if date_str[-2:] == '60':
        return datetime.datetime.strptime(date_str[:-2], '%Y%m%d.%H') + datetime.timedelta(hours=1)
    else:
        print('ERROR parsing date: {:}'.format(date_str), file=sys.stderr)
        sys.exit(1)
        

# Model EIGEN-GRGS.RL04.MEAN-FIELD.gfc (n,m) = (3,3)
eigen_grgs_rl04 = [
{'coef': 'gfct', 'C':  9.04806377826E-07, 'S': -6.18999390102E-07, 't0': '19500101.0000', 't1': '20020915.1947'},
{'coef': 'trnd', 'C':  0.00000000000E+00, 'S':  0.00000000000E+00, 't0': '19500101.0000', 't1': '20020915.1946'},
{'coef': 'acos', 'C':  7.53144426550E-12, 'S': -3.51106952767E-12, 't0': '19500101.0000', 't1': '20020915.1946', 'per': 1.0},
{'coef': 'asin', 'C':  8.78867102554E-13, 'S':  5.31777383977E-11, 't0': '19500101.0000', 't1': '20020915.1946', 'per':  1.0},
{'coef': 'acos', 'C': -8.38675502667E-12, 'S':  5.08013371792E-12, 't0': '19500101.0000', 't1': '20020915.1946', 'per':  0.5},
{'coef': 'asin', 'C':  1.82385601647E-12, 'S':  9.28402226686E-12, 't0': '19500101.0000', 't1': '20020915.1946', 'per':  0.5},
{'coef': 'gfct', 'C':  9.04806377824E-07, 'S': -6.18999390091E-07, 't0': '20020915.1946', 't1': '20040101.0000'},
{'coef': 'trnd', 'C': -2.26391425597E-11, 'S': -1.98267058273E-12, 't0': '20020915.1946', 't1': '20040101.0000'},
{'coef': 'acos', 'C':  2.11162763291E-11, 'S': -1.47184684460E-13, 't0': '20020915.1946', 't1': '20040101.0000', 'per': 1.0},
{'coef': 'asin', 'C': -3.15615043365E-12, 'S':  4.66848334813E-11, 't0': '20020915.1946', 't1': '20040101.0000', 'per': 1.0},
{'coef': 'acos', 'C': -8.30155029443E-13, 'S':  4.38757555932E-12, 't0': '20020915.1946', 't1': '20040101.0000', 'per': 0.5},
{'coef': 'asin', 'C':  1.32407476080E-11, 'S': -2.50004414417E-12, 't0': '20020915.1946', 't1': '20040101.0000', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04777091048E-07, 'S': -6.19001954942E-07, 't0': '20040101.0000', 't1': '20041226.0060'},
{'coef': 'trnd', 'C':  6.44066358713E-12, 'S':  6.43979027943E-12, 't0': '20040101.0000', 't1': '20041226.0060'},
{'coef': 'acos', 'C':  1.10058067517E-11, 'S':  5.51093596033E-12, 't0': '20040101.0000', 't1': '20041226.0060', 'per': 1.0},
{'coef': 'asin', 'C':  1.53889263200E-11, 'S':  5.06748697724E-11, 't0': '20040101.0000', 't1': '20041226.0060', 'per': 1.0},
{'coef': 'acos', 'C':  9.27097286116E-12, 'S': -1.18848133143E-12, 't0': '20040101.0000', 't1': '20041226.0060', 'per': 0.5},
{'coef': 'asin', 'C':  6.69783779885E-12, 'S': -4.21101172095E-12, 't0': '20040101.0000', 't1': '20041226.0060', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04755254039E-07, 'S': -6.18978962604E-07, 't0': '20041226.0060', 't1': '20060101.0000'},
{'coef': 'trnd', 'C':  4.65844207521E-11, 'S': -1.55539422305E-11, 't0': '20041226.0060', 't1': '20060101.0000'},
{'coef': 'acos', 'C':  1.42225134590E-11, 'S': -8.38831979988E-12, 't0': '20041226.0060', 't1': '20060101.0000', 'per': 1.0},
{'coef': 'asin', 'C':  1.15480984243E-12, 'S':  4.31960845856E-11, 't0': '20041226.0060', 't1': '20060101.0000', 'per': 1.0},
{'coef': 'acos', 'C':  2.19873738372E-12, 'S': -2.46503405556E-12, 't0': '20041226.0060', 't1': '20060101.0000', 'per': 0.5},
{'coef': 'asin', 'C':  2.41403112318E-12, 'S': -2.96706725861E-12, 't0': '20041226.0060', 't1': '20060101.0000', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04802596854E-07, 'S': -6.18994769765E-07, 't0': '20060101.0000', 't1': '20070101.0000'},
{'coef': 'trnd', 'C': -2.21012173047E-11, 'S':  3.83513003612E-13, 't0': '20060101.0000', 't1': '20070101.0000'},
{'coef': 'acos', 'C':  1.65828339294E-11, 'S': -1.94209075549E-12, 't0': '20060101.0000', 't1': '20070101.0000', 'per': 1.0},
{'coef': 'asin', 'C':  3.07435419440E-12, 'S':  6.45039359048E-11, 't0': '20060101.0000', 't1': '20070101.0000', 'per': 1.0},
{'coef': 'acos', 'C': -1.15831905515E-13, 'S': -8.74184455615E-12, 't0': '20060101.0000', 't1': '20070101.0000', 'per': 0.5},
{'coef': 'asin', 'C':  1.01771026507E-11, 'S':  2.56533809602E-12, 't0': '20060101.0000', 't1': '20070101.0000', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04780495637E-07, 'S': -6.18994386252E-07, 't0': '20070101.0000', 't1': '20080101.0000'},
{'coef': 'trnd', 'C': -1.36287982155E-11, 'S': -5.28039838934E-13, 't0': '20070101.0000', 't1': '20080101.0000'},
{'coef': 'acos', 'C':  1.25694789295E-11, 'S': -1.36739381958E-11, 't0': '20070101.0000', 't1': '20080101.0000', 'per': 1.0},
{'coef': 'asin', 'C':  5.48417244833E-12, 'S':  5.74345418665E-11, 't0': '20070101.0000', 't1': '20080101.0000', 'per': 1.0},
{'coef': 'acos', 'C':  4.07774943201E-12, 'S':  3.14697882171E-12, 't0': '20070101.0000', 't1': '20080101.0000', 'per': 0.5},
{'coef': 'asin', 'C': -1.11957658293E-12, 'S':  2.78999404374E-12, 't0': '20070101.0000', 't1': '20080101.0000', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04766866838E-07, 'S': -6.18994914291E-07, 't0': '20080101.0000', 't1': '20090101.0000'},
{'coef': 'trnd', 'C': -2.05703727704E-11, 'S': -3.42770145105E-11, 't0': '20080101.0000', 't1': '20090101.0000'},
{'coef': 'acos', 'C':  9.83750881512E-12, 'S': -3.76966221848E-12, 't0': '20080101.0000', 't1': '20090101.0000', 'per': 1.0},
{'coef': 'asin', 'C':  1.04056784693E-12, 'S':  3.63134777419E-11, 't0': '20080101.0000', 't1': '20090101.0000', 'per': 1.0},
{'coef': 'acos', 'C':  6.84122830726E-12, 'S': -6.63632715694E-12, 't0': '20080101.0000', 't1': '20090101.0000', 'per': 0.5},
{'coef': 'asin', 'C': -5.72697482419E-12, 'S': -1.12483716481E-11, 't0': '20080101.0000', 't1': '20090101.0000', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04746296466E-07, 'S': -6.19029191306E-07, 't0': '20090101.0000', 't1': '20100227.0735'},
{'coef': 'trnd', 'C':  1.40244495125E-11, 'S':  2.13647209805E-11, 't0': '20090101.0000', 't1': '20100227.0735'},
{'coef': 'acos', 'C':  1.60191908290E-11, 'S': -5.00430627062E-12, 't0': '20090101.0000', 't1': '20100227.0735', 'per': 1.0},
{'coef': 'asin', 'C': -2.58923358995E-12, 'S':  5.70156212951E-11, 't0': '20090101.0000', 't1': '20100227.0735', 'per': 1.0},
{'coef': 'acos', 'C':  6.68508036757E-13, 'S': -5.20036876365E-12, 't0': '20090101.0000', 't1': '20100227.0735', 'per': 0.5},
{'coef': 'asin', 'C':  3.17905262940E-12, 'S':  6.43917255656E-12, 't0': '20090101.0000', 't1': '20100227.0735', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04789105776E-07, 'S': -6.18998427491E-07, 't0': '20100227.0735', 't1': '20110311.0515'},
{'coef': 'trnd', 'C': -8.74533802892E-11, 'S': -8.65622390476E-12, 't0': '20100227.0735', 't1': '20110311.0515'},
{'coef': 'acos', 'C':  4.17870032671E-11, 'S':  1.73419918304E-11, 't0': '20100227.0735', 't1': '20110311.0515', 'per': 1.0},
{'coef': 'asin', 'C':  2.09785819672E-12, 'S':  4.63554877704E-11, 't0': '20100227.0735', 't1': '20110311.0515', 'per': 1.0},
{'coef': 'acos', 'C':  4.76649139487E-12, 'S':  1.15911028069E-11, 't0': '20100227.0735', 't1': '20110311.0515', 'per': 0.5},
{'coef': 'asin', 'C':  5.98331197176E-12, 'S':  1.07714116879E-11, 't0': '20100227.0735', 't1': '20110311.0515', 'per': 0.5},
{'coef': 'gfct', 'C':  9.04714299831E-07, 'S': -6.18980761504E-07, 't0': '20110311.0515', 't1': '20120101.0000'},
{'coef': 'trnd', 'C':  3.15828965497E-11, 'S': -8.81517889974E-12, 't0': '20110311.0515', 't1': '20120101.0000'},
{'coef':'gfct', 'C':  9.04739893347E-07,'S': -6.18987904973E-07,'t0': '20120101.0000','t1': '20130101.0000'},
{'coef':'trnd', 'C':  2.29453944051E-11,'S': -5.38420239313E-11,'t0': '20120101.0000','t1': '20130101.0000'},
{'coef':'acos', 'C':  9.52442351455E-13,'S':  1.93923127480E-12,'t0': '20120101.0000','t1': '20130101.0000', 'per': 1.0},
{'coef':'asin', 'C': -1.09609243225E-11,'S':  3.98306193251E-11,'t0': '20120101.0000','t1': '20130101.0000', 'per':  1.0},
{'coef':'acos', 'C': -6.27351621089E-13,'S': -2.27270475959E-12,'t0': '20120101.0000','t1': '20130101.0000', 'per':  0.5},
{'coef':'asin', 'C': -2.09930692481E-11,'S': -3.56701759088E-12,'t0': '20120101.0000','t1': '20130101.0000', 'per':  0.5},
{'coef':'gfct', 'C':  9.04762838741E-07,'S': -6.19041746997E-07,'t0': '20130101.0000','t1': '20140101.0000'},
{'coef':'trnd', 'C': -2.78843023738E-11,'S':  2.84546281127E-11,'t0': '20130101.0000','t1': '20140101.0000'},
{'coef':'acos', 'C':  1.51978692830E-11,'S': -7.82558662004E-12,'t0': '20130101.0000','t1': '20140101.0000', 'per':  1.0},
{'coef':'asin', 'C':  4.78169511153E-12,'S':  5.05526580711E-11,'t0': '20130101.0000','t1': '20140101.0000', 'per':  1.0},
{'coef':'acos', 'C': -1.53054434457E-11,'S':  7.83728222611E-12,'t0': '20130101.0000','t1': '20140101.0000', 'per':  0.5},
{'coef':'asin', 'C':  1.60063479644E-12,'S':  1.45045097089E-13,'t0': '20130101.0000','t1': '20140101.0000', 'per':  0.5},
{'coef':'gfct', 'C':  9.04734954439E-07,'S': -6.19013292368E-07,'t0': '20140101.0000','t1': '20150101.0000'},
{'coef':'trnd', 'C':  1.12495882174E-11,'S': -3.85924433013E-11,'t0': '20140101.0000','t1': '20150101.0000'},
{'coef':'acos', 'C':  1.61302081410E-12,'S': -7.00209920306E-12,'t0': '20140101.0000','t1': '20150101.0000', 'per':  1.0},
{'coef':'asin', 'C':  5.81434896838E-12,'S':  3.75817334927E-11,'t0': '20140101.0000','t1': '20150101.0000', 'per':  1.0},
{'coef':'acos', 'C': -2.32976520621E-12,'S':  7.54045739906E-12,'t0': '20140101.0000','t1': '20150101.0000', 'per':  0.5},
{'coef':'asin', 'C':  1.00069381009E-11,'S': -1.10138036702E-11,'t0': '20140101.0000','t1': '20150101.0000', 'per':  0.5},
{'coef':'gfct', 'C':  9.04746204027E-07,'S': -6.19051884812E-07,'t0': '20150101.0000','t1': '20160715.2141'},
{'coef':'trnd', 'C': -2.49187929049E-12,'S': -1.50251543986E-11,'t0': '20150101.0000','t1': '20160715.2141'},
{'coef':'acos', 'C':  7.55418982546E-12,'S': -4.71587108895E-12,'t0': '20150101.0000','t1': '20160715.2141', 'per':  1.0},
{'coef':'asin', 'C':  3.67292805904E-13,'S':  5.46379236961E-11,'t0': '20150101.0000','t1': '20160715.2141', 'per':  1.0},
{'coef':'acos', 'C': -9.15297448775E-12,'S':  5.77742188264E-12,'t0': '20150101.0000','t1': '20160715.2141', 'per':  0.5},
{'coef':'asin', 'C':  1.24857117695E-12,'S':  1.17831339319E-11,'t0': '20150101.0000','t1': '20160715.2141', 'per':  0.5},
{'coef':'gfct', 'C':  9.04742371547E-07,'S': -6.19074993314E-07,'t0': '20160715.2141','t1': '20500101.0000'},
{'coef':'trnd', 'C':  3.02599191532E-12,'S': -1.89403297584E-11,'t0': '20160715.2141','t1': '20500101.0000'},
{'coef':'acos', 'C':  7.53144426550E-12,'S': -3.51106952767E-12,'t0': '20160715.2141','t1': '20500101.0000', 'per':  1.0},
{'coef':'asin', 'C':  8.78867102554E-13,'S':  5.31777383977E-11,'t0': '20160715.2141','t1': '20500101.0000', 'per':  1.0},
{'coef':'acos', 'C': -8.38675502667E-12,'S':  5.08013371792E-12,'t0': '20160715.2141','t1': '20500101.0000', 'per':  0.5},
{'coef':'asin', 'C':  1.82385601647E-12,'S':  9.28402226686E-12,'t0': '20160715.2141','t1': '20500101.0000', 'per':  0.5}
]

def CS32(t):
    C = 0e0
    S = 0e0
    for d in eigen_grgs_rl04:
        #print(d)
        t0 = d2s(d['t0'])
        t1 = d2s(d['t1'])
        #print('from {:} to {:}'.format(t0,t1))
        if t >= t0 and t < t1:
            if d['coef'] == 'gfct':
                C += d['C']
                #print('{:+.15e}'.format(d['C']))
                S += d['S']
            elif d['coef'] == 'trnd':
                diff = t - t0
                dt = (diff.days + diff.seconds/86400e0) / 365.25e0
                C += d['C'] * dt
                #print('{:+.15e} * {:.12e}'.format(d['C'], dt))
                S += d['S'] * dt
            elif d['coef'] == 'asin':
                diff = t - t0
                dt = (diff.days + diff.seconds/86400e0) / 365.25e0
                per = d['per']
                C += d['C'] * math.sin((math.pi * 2e0 / per)*dt)
                #print('{:+.15e} * {:.12e}'.format(d['C'], math.sin((math.pi * 2e0 / per)*dt)))
                S += d['S'] * math.sin((math.pi * 2e0 / per)*dt)
            elif d['coef'] == 'acos':
                diff = t - t0
                dt = (diff.days + diff.seconds/86400e0) / 365.25e0
                per = d['per']
                C += d['C'] * math.cos((math.pi * 2e0 / per)*dt)
                #print('{:+.15e} * {:.12e}'.format(d['C'], math.cos((math.pi * 2e0 / per)*dt)))
                S += d['S'] * math.cos((math.pi * 2e0 / per)*dt)
    return C, S

for year in range(1995, 2025):
    c,s = CS32(datetime.datetime(year,1,1))
    print("C = {:+.15e} S = {:+.15e}".format(c,s))
