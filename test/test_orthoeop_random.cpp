#include "iers2010.hpp"
#include <cassert>

constexpr double PRECISION_MAS = 1e-12;
constexpr double PRECISION_MS = 1e-13;

int main() {
  printf("Testing ORTHO_EOP results vs Fortran\n"); 
  printf("Precision for xp,yp (pole) = %.15e [microasrseconds]\n", PRECISION_MAS);
  printf("Precision for DUT1         = %.15e [microseconds]\n", PRECISION_MS);

  double dx,dy,dut;

  /* paste results from make_test_orthoeop.f here */
       struct Result {double t,dx,dy,dut;} R[]={
{  0.4585169797975651454180E+05,-0.614079333935045838E+03, -0.37565412620173402E+03,  0.23807383076506380E+02},
{  0.5584779382660504779778E+05, 0.276744204827684712E+03, -0.23882018322788338E+03,  0.24776210835503796E+01},
{  0.4673583145211623923387E+05, 0.731256925457735861E+03, -0.28635933601185553E+03,  0.44588231637345245E+02},
{  0.4879338057439059048193E+05, 0.186620016301866116E+03, -0.16079286845326769E+03,  0.22678607628418819E+01},
{  0.5084701579376203881111E+05, 0.261464141354045978E+03, -0.18972350772859411E+03,  0.24116186938986736E+02},
{  0.5971444841035202261992E+05, 0.352975683786280115E+03,  0.13293985109003659E+02,  0.38834980265375137E+02},
{  0.5590634143843898345949E+05, 0.981114181071099445E+01, -0.19060432006128082E+03,  0.24440583541797753E+02},
{  0.5853557326358919090126E+05,-0.117719245097656071E+03,  0.45795907796674175E+03, -0.14678149219288603E+02},
{  0.4585314006664364569588E+05,-0.340619920829229955E+03,  0.58654400106318042E+03, -0.69029843155902952E+02},
{  0.5442028946407717012335E+05,-0.347894716517622669E+03, -0.25311785265831440E+03,  0.20996611752916944E+02},
{  0.4693787851433119067224E+05,-0.754962262729606408E+02,  0.21083139469654125E+03, -0.22173286988224035E+02},
{  0.5102297731917584314942E+05, 0.254206274972159775E+03, -0.59642595783477219E+02,  0.11562468275365561E+02},
{  0.5850280751471038092859E+05, 0.778500612273168713E+03, -0.26427845469794653E+03,  0.31464089200399595E+02},
{  0.4619048270245391177014E+05, 0.423180507767560130E+03, -0.21715159909353691E+02,  0.48138010769711066E+02},
{  0.5950872305032503936673E+05,-0.133179956816497025E+03, -0.10751578605542618E+03, -0.22640245200836084E+02},
{  0.4856867590053462481592E+05,-0.307911052586015501E+03,  0.31157532982756288E+03, -0.55934359954239248E+02},
{  0.5269267462099150725408E+05, 0.996082405184583450E+02,  0.70607262204148171E+02,  0.19688561876018415E+02},
{  0.5531906526661604584660E+05,-0.343207670657358221E+02,  0.33789887231791238E+03, -0.10758891992053940E+02},
{  0.4678999376888434198918E+05,-0.202543573459042477E+03, -0.21899716285732509E+03,  0.15954552011926433E+02},
{  0.5751671769119588134345E+05,-0.661056615529662281E+03, -0.31778791416945751E+03,  0.16710925441205259E+02},
{  0.5880569486875734583009E+05,-0.157033679076156915E+03,  0.42435270248337014E+03, -0.39818355705823954E+02},
{  0.4615285778332852351014E+05,-0.257600167891853175E+03, -0.30830031123380388E+03,  0.25436415288528508E+02},
{  0.4641987859154539182782E+05,-0.481648256724198234E+02,  0.10654852482682550E+02,  0.91192414320314068E+01},
{  0.4951980338522664533230E+05,-0.318703961323842861E+03,  0.13032692332592831E+03, -0.20520293055102556E+02},
{  0.5277375599615470855497E+05, 0.595599040302371918E+02, -0.33011828330629106E+03,  0.20789523979380686E+02},
{  0.5382710734138794214232E+05,-0.204178782361245879E+03,  0.52119865847191886E+03, -0.44152133449108653E+02},
{  0.5067883300202853570227E+05, 0.208842635793925638E+03, -0.30914367492023968E+03,  0.37036367946005853E+02},
{  0.4986683119421543233329E+05, 0.283480763081454121E+02, -0.20613061169870926E+03,  0.22738327900126517E+02},
{  0.5953597860364286316326E+05, 0.210155281553405686E+02,  0.62961765777004629E+02,  0.20011381821736663E+02},
{  0.6126690378073271131143E+05, 0.366835694293930828E+03, -0.19052499580808342E+03,  0.32906984099515860E+02},
{  0.4786870270687130687293E+05, 0.506497510890258184E+03, -0.13238516958046870E+03,  0.25291603876197126E+02},
{  0.5077736439956413960317E+05,-0.215977831545276757E+02,  0.18034573604813994E+03, -0.10973904614009200E+02},
{  0.4683221081328842410585E+05,-0.161478452613953579E+03,  0.19584236296643826E+03, -0.15594780896866506E+02},
{  0.5418007153413495689165E+05,-0.132402888534205402E+03,  0.52680136084745743E+03, -0.49831723139638733E+02},
{  0.5854328372904453863157E+05,-0.341364897948843762E+02,  0.12640360673037073E+03, -0.39218663170873880E+01},
{  0.5846457636720684240572E+05, 0.135383697689605889E+02,  0.33552490807309329E+03, -0.14771383686189013E+02},
{  0.5376299898619002487976E+05,-0.925474913684257672E+02, -0.16517437473415833E+03,  0.37907431834959574E+02},
{  0.5958028055748971382855E+05,-0.597086013387031684E+02, -0.19299170993725284E+03,  0.22073947091342706E+02},
{  0.4731135105200301040895E+05, 0.725213772680610987E+03, -0.20457534020012713E+03,  0.38891496385112362E+02},
{  0.5358504970816722197924E+05,-0.218710901636383397E+03,  0.46574453393717317E+03, -0.54034687495143679E+02},
{  0.5686773828673650132259E+05,-0.459303530163236815E+03, -0.20866784552272114E+03, -0.16197872419718276E+01},
{  0.5797365108735135436291E+05,-0.536368813620043966E+03, -0.12681160134436699E+03,  0.22505885864561783E+01},
{  0.5522822213447935791919E+05,-0.605805809324811207E+03, -0.19285766393968780E+03, -0.10135109668647033E+02},
{  0.5540868178476185130421E+05,-0.283769819425963817E+03,  0.20445100300002440E+03, -0.22398392229126433E+02},
{  0.5144584941762304515578E+05, 0.418532502524458550E+03, -0.13729338820110328E+03,  0.28956945816976603E+02},
{  0.4601307301468124205712E+05,-0.375415236127139565E+03, -0.60622553711398384E+01,  0.11574232798828126E+02},
{  0.5289636640525675466051E+05, 0.111711462331293745E+03, -0.28160190208067507E+03,  0.20569044508831734E+02},
{  0.5294624574094773561228E+05, 0.286378233517873355E+03, -0.15157065071749673E+03,  0.16223499269492393E+02},
{  0.6158724491510208463296E+05, 0.644816159776779614E+03, -0.18809871276600316E+03,  0.24694132413416160E+02},
{  0.5122143755470914038597E+05,-0.128999451193877661E+03,  0.40577942252135540E+03, -0.38431479447268153E+02},
{  0.5203580631524384807562E+05, 0.214871770416581313E+03, -0.23251965181514933E+03,  0.19501555730887890E+02},
{  0.5321073822964614373632E+05,-0.223316294537777821E+03,  0.22567492516785120E+03, -0.25456042569389833E+02},
{  0.5811822996311277529458E+05,-0.131882699405096702E+03, -0.34931760783191680E+03,  0.28464446038331626E+02},
{  0.4635621720803279458778E+05,-0.484498245350836555E+03, -0.27562258988188205E+03,  0.28007164010406701E+02},
{  0.4792333919238446105737E+05,-0.270403810049564242E+03,  0.88351262914027071E+01, -0.33885786450756143E+02},
{  0.5604254092375257459935E+05, 0.405336284162873255E+03, -0.25742635790625222E+02,  0.21833536766192452E+02},
{  0.5826313692141677165637E+05, 0.357456723123046061E+02, -0.11469141572168903E+03, -0.22210548828782506E+00},
{  0.6235285423979528422933E+05,-0.160400020178630626E+03,  0.32699867191388608E+03, -0.33764976316461592E+02},
{  0.5951528264808610401815E+05,-0.179461017380987272E+03, -0.21576100767112510E+03,  0.20677854564678150E+02},
{  0.4964051282632763468428E+05,-0.328778351835265312E+03,  0.77199385472634518E+02, -0.17883809485992103E+02},
{  0.5737672128636352863396E+05, 0.433357868755733477E+03, -0.31368100758743378E+02,  0.19420192076925499E+02},
{  0.5412940908055761246942E+05,-0.154179990352089590E+03,  0.46812572260995302E+03, -0.45398968875750690E+02},
{  0.5912183111517842917237E+05, 0.298824094513262025E+03, -0.65388679671022942E+02,  0.21362341285798323E+02},
{  0.4985560431476807571016E+05, 0.184304737015569543E+03, -0.41270478839636397E+02,  0.23067742012466638E+02},
{  0.6120352343971715163207E+05,-0.465584608962048378E+03, -0.20774643078328089E+03,  0.23737500711343817E+02},
{  0.4761258761890378809767E+05, 0.261547108248954032E+03,  0.20181384911217673E+02,  0.17676877752071221E+02},
{  0.5163317014427047979552E+05,-0.881068695014950976E+02, -0.36092722964187686E+02,  0.67248249011963610E+01},
{  0.4672673175938369968208E+05,-0.228666464796971667E+03,  0.32116728321900337E+03, -0.43787383717921742E+02},
{  0.6162146298170566296903E+05, 0.686685439461799660E+03, -0.68124679038056428E+02,  0.21842354775171216E+02},
{  0.4836197529873929306632E+05, 0.166463409084765715E+03,  0.41454640833232497E+03, -0.21988954771996916E+02},
{  0.4813200507369308616035E+05, 0.258036388577817547E+03,  0.83618808894849849E+02, -0.17116422972219482E+02},
{  0.4668863802444129396463E+05,-0.447160916189217119E+03, -0.28372559298601630E+03,  0.19974360834492067E+02},
{  0.5246712682410558772972E+05,-0.360778518480989874E+03,  0.59762116001968684E+03, -0.69490321178619581E+02},
{  0.5730710905470780562609E+05,-0.484797940379089368E+03,  0.22091542587053219E+02, -0.11411250404142411E+02},
{  0.5233753898030432173982E+05, 0.550677644543742190E+03, -0.25668645434269806E+02,  0.21318756770369657E+02},
{  0.6153564238432170532178E+05, 0.189089707826897069E+02, -0.13953524278287858E+03,  0.27482099877296793E+02},
{  0.5676205001986052957363E+05,-0.280937308600984522E+03,  0.44729857476267694E+03, -0.43932225408891391E+02},
{  0.4956220690059076150646E+05,-0.746479951682267000E+02,  0.12134309272479321E+03, -0.20854174386357087E+01},
{  0.5792375622241906967247E+05, 0.125881014726266386E+03,  0.36523866581208573E+02,  0.51512871736557422E+01},
{  0.5440211856248440017225E+05,-0.209942436034163677E+03, -0.14129246168384921E+03,  0.32047340072587190E+02},
{  0.5213517229831220902270E+05, 0.449089462936795485E+03, -0.87459407750085802E+02,  0.15661189926256629E+02},
{  0.5355950606396308285184E+05, 0.431674224566829366E+03, -0.69666347744592358E+02,  0.25037044049584090E+02},
{  0.5270026278676590300165E+05,-0.154465345811830929E+03, -0.35580558623904074E+03,  0.24634922423450945E+02},
{  0.5378475542073336691828E+05,-0.356788132409498871E+03, -0.66626536839031289E+02,  0.77975374414692122E+00},
{  0.5931204974788151594112E+05,-0.392184622052761938E+03, -0.56972836257955606E+02, -0.86416413698928773E+00},
{  0.5842761969877793308115E+05,-0.332900216971316979E+03, -0.22209226072499614E+02, -0.25406154418935206E+02},
{  0.5885795179797546734335E+05, 0.389109987028360706E+03, -0.89603768031991478E+02,  0.37089517981658048E+02},
{  0.5416446077854172472144E+05, 0.392544390592886543E+03,  0.89255098773152000E+02,  0.20292448343008346E+02},
{  0.6136805439537599158939E+05,-0.474218964577679003E+03, -0.14018267996010405E+03,  0.25991738931684157E+02},
{  0.5511639961211314948741E+05,-0.268745086887809407E+03, -0.16918470082013553E+03,  0.19334891647130544E+02},
{  0.5513699486720276763663E+05,-0.845529830143707102E+02,  0.69529191740810433E+02,  0.18300395132139474E+02},
{  0.5028857675879998714663E+05, 0.331059566416825675E+02, -0.19880808287374140E+03,  0.23266754041361121E+02},
{  0.6095162656926381168887E+05,-0.296795348958952559E+03, -0.21770497178076567E+03,  0.13049033985866744E+02},
{  0.5639145663787923695054E+05, 0.210829243333253629E+03,  0.15142547969299872E+03,  0.18344276451747632E+02},
{  0.5966991158638222987065E+05, 0.500316979901263664E+03,  0.57609803018964442E+02,  0.90926994688408485E+01},
{  0.6087014244570813752944E+05,-0.272518032165338809E+03,  0.49034465564009190E+03, -0.44942254000212685E+02},
{  0.5543116373856232530670E+05,-0.144776699631389448E+03,  0.37253284690111300E+02, -0.27095166078613786E+02},
{  0.5572309531237669580150E+05, 0.212467701436506957E+03, -0.63964062205856948E+02, -0.32631083657735993E+01},
{  0.4620369948839929566020E+05,-0.363830471172998841E+03, -0.33208530551372644E+03,  0.17762284459155794E+02},
{  0.5476471332332884776406E+05, 0.227513444684409336E+03, -0.21750825405722387E+03,  0.17465288316816068E+02 }};
for (int i=0; i<  100; i++) {
       iers2010::ortho_eop(R[i].t,dx,dy,dut);
     assert(std::abs(dx-R[i].dx)<PRECISION_MAS);
     assert(std::abs(dy-R[i].dy)<PRECISION_MAS);
    assert(std::abs(dut-R[i].dut)<PRECISION_MS);
}
  /* end of FORTRAN source */

  printf("All tests passed!\n");
  return 0;
}
